<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.scss">
    <title>Word Cloud Generator</title>

    <script src="https://d3js.org/d3.v4.js"></script>

    <!-- Load d3-cloud -->
    <script src="https://cdn.jsdelivr.net/gh/holtzy/D3-graph-gallery@master/LIB/d3.layout.cloud.js"></script>
    
    <!-- Create a div where the graph will take place -->
    
<!-- html2canvas library for converting SVG to image -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.js"></script>
</head>

<body>
    <div class="container">
        <div class="sidebar">
            <div class="import">
                <div class="import-method">
                    <label>
                        <input type="radio" name="import-method" class="input-url"> Import from web:
                    </label>
                    <textarea id="url" rows="3"></textarea>
                </div>
                <div class="import-method">
                    <label>
                        <input type="radio" name="import-method" class="upload-file"> Upload file: <button>Browse</button>
                    </label>
                </div>
            </div>
            <div class="text">
            <textarea id="word-input" placeholder="Enter your text here..." rows="13"></textarea>
            </div>
            <div class="color-palette">
                <div class="palette1">
                    <span><input type="radio" name="palette"> Light</span>
                    <div class="color-options">
                        <div class="color-circle" style="background-color: #1A0878;"></div>
                        <div class="color-circle" style="background-color: #5A1F9F;"></div>
                        <div class="color-circle" style="background-color: #FF4D27;"></div>
                        <div class="color-circle" style="background-color: #000000;"></div>
                        <div class="color-circle" style="background-color: #AA4BF5;"></div>
                    </div>
                </div>
                <div class="palette2">
                    <span><input type="radio" name="palette"> Dark</span>
                    <div class="color-options">
                        <div class="color-circle" style="background-color: #C8DCE9;"></div>
                        <div class="color-circle" style="background-color: #AA4BF5;"></div>
                        <div class="color-circle" style="background-color: #FF885B;"></div>
                        <div class="color-circle" style="background-color: #FF4D27;"></div>
                        <div class="color-circle" style="background-color: #E3E3E3;"></div>
                        <div class="color-circle" style="background-color: #FFFFFF;"></div>
                    </div>
                </div>
            </div>

            <div class="max">
                <label for="max-words">Max Words:</label>
                <input type="number" id="max-words" min="1" max="1000" value="500">
            </div>

            <div class="rotation">
                <label>Rotation:</label>
                <div class="rotation-options">
                    <label><input type="radio" name="rotation" value="horizontal"> Horizontal</label>
                    <label><input type="radio" name="rotation" value="vertical"> Vertical</label>
                    <label><input type="radio" name="rotation" value="diagonal"> Diagonal Mix</label>
                </div>
            </div>

            <div class="generate">
                <button id="generate">Generate</button>
            </div>
        </div>

        <div class="main-content">
           
                <div id="my_dataviz">

                    <script>
                        function generateWordCloud(text) {
    // Split the text into an array of words
    const wordsArray = text.split(/\s+/);
    console.log(wordsArray);
    
    // Count the frequency of each word
    const wordCounts = {};
    wordsArray.forEach(word => {
        word = word.toLowerCase(); // Normalize to lowercase for counting
        wordCounts[word] = (wordCounts[word] || 0) + 1;
    });

    // Convert the word counts object into an array of objects for the word cloud
    const myWords = Object.keys(wordCounts).map(word => ({
        text: word,
        size: wordCounts[word] * 20 // Scale the size of the word based on frequency
    }));

    // Set the dimensions and margins of the graph
    var margin = {top: 10, right: 10, bottom: 10, left: 10},
        width = 450 - margin.left - margin.right,
        height = 450 - margin.top - margin.bottom;

    // Clear any existing word cloud before appending new one
    d3.select("#my_dataviz").html(""); // Clear existing content
    
    // Show the word cloud container after content is generated
    d3.select("#my_dataviz").style("display", "block"); // Show the div

    // Append the svg object to the body of the page
    var svg = d3.select("#my_dataviz").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    // Constructs a new cloud layout instance. It runs an algorithm to find the position of words
    var layout = d3.layout.cloud()
        .size([width, height])
        .words(myWords) // Use the word count data with the size
        .padding(10)
        .fontSize(function(d) { return d.size; })
        .on("end", draw);

    // Start the layout process
    layout.start();

    // This function takes the output of 'layout' above and draws the words
    function draw(words) {
        svg
            .append("g")
            .attr("transform", "translate(" + layout.size()[0] / 2 + "," + layout.size()[1] / 2 + ")")
            .selectAll("text")
            .data(words)
            .enter().append("text")
            .style("font-size", function(d) { return d.size + "px"; })
            .attr("text-anchor", "middle")
            .attr("transform", function(d) {
                return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
            })
            .text(function(d) { return d.text; });
    }
}

// Add event listener for "Generate" button
document.getElementById("generate").addEventListener("click", () => {
    const text = document.getElementById("word-input").value;
    if (text.trim() === "") {
        alert("Please enter some text before generating the word cloud!");
        return;
    }
    
    localStorage.setItem("text", text); // Optionally save to localStorage if you want to persist text
    console.log("Captured text:", text); // Log for debugging purposes
    
    generateWordCloud(text); // Call the function to generate the word cloud immediately
});
            </script>
            </div>
        </div>
        <div class="download-btn">
            <button id="download">Download</button>
        </div>
    </div>
    <script src="script.js"></script>


    

    <script>
  document.getElementById("download").addEventListener("click", function() {
    // Select the div containing the word cloud (the parent div of the SVG)
    const wordCloudElement = document.getElementById("my_dataviz");

    // Check if the word cloud element exists and contains words (i.e., is not empty)
    if (!wordCloudElement || wordCloudElement.style.display === "none" || wordCloudElement.querySelectorAll("text").length === 0) {
        console.error("Word cloud element not found or not rendered! Ensure that the word cloud has been generated.");
        alert("Cannot download because there is no text inputted!");
        return;
    }

    // Log the word cloud element for debugging
    console.log("Word Cloud Element:", wordCloudElement);

    // Use html2canvas to capture the element as a canvas
    html2canvas(wordCloudElement).then(function(canvas) {
        // Create an image URL from the canvas
        const imgURL = canvas.toDataURL("image/png");

        // Create an anchor link and trigger the download
        const link = document.createElement("a");
        link.href = imgURL;
        link.download = "word-cloud.png"; // Set the filename
        link.click(); // Trigger the download
    }).catch(function(error) {
        console.error("Error generating PNG:", error);
    });
});

    </script>
</body>

</html>




